<div class="message-list" #scrollContainer>
    @for (message of messages; track message.id) {
        <div class="message-wrapper"
             [class.own-message]="isOwnMessage(message)"
             [class.system-message]="message.type === MessageType.JOIN || message.type === MessageType.LEAVE"
             [class.oracle-wrapper]="message.type === MessageType.ORACLE">

            <!-- System messages -->
            @if (message.type === MessageType.JOIN || message.type === MessageType.LEAVE) {
                <div class="system-message-content">
                    {{ message.content }}
                </div>
            }

            <!-- Oracle messages -->
            @if (message.type === MessageType.ORACLE) {
                <div class="oracle-message">
                    <div class="oracle-avatar">
                        <mat-icon>auto_awesome</mat-icon>
                    </div>
                    <div class="oracle-content">
                        <div class="oracle-label">Oracle</div>
                        <div class="oracle-text">{{ message.content }}</div>
                        <div class="oracle-meta">
                            @if (message.oracleMetadata) {
                                Forged from {{ message.oracleMetadata.messagesAnalyzed }} messages
                                ({{ message.oracleMetadata.uniqueTokens }} unique words,
                                order-{{ message.oracleMetadata.chainOrder }} chain)
                            } @else {
                                Forged from recent whispers
                            }
                        </div>
                    </div>
                </div>
            }

            <!-- Regular chat messages -->
            @if (message.type === MessageType.CHAT) {
                <mat-card class="message-card">
                    <mat-card-header>
                        <div class="message-header">
                            <span class="username">{{ message.senderUsername }}</span>
                            <span class="timestamp">{{ message.timestamp | date:'short' }}</span>
                        </div>
                    </mat-card-header>
                    <mat-card-content>
                        <p class="message-content">{{ message.content }}</p>
                        @if (message.edited) {
                            <span class="edited-indicator">(edited)</span>
                        }
                    </mat-card-content>
                </mat-card>
            }
        </div>
    }
</div>